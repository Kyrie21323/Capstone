{% extends "base.html" %}

{% block title %}Your Matches - {{ event.name }}{% endblock %}

{% block body_class %}matches-page{% endblock %}

{% block content %}
<div class="matches-page-container">
    <div class="page-header">
        <div>
            <p class="page-subtitle">{{ event.name }}</p>
            <h1 class="page-title">Your Matches</h1>
        </div>
        <div class="header-actions">
            {% if current_user.is_administrator() %}
            <a href="{{ url_for('matching.event_graph_page', event_id=event.id) }}" class="btn btn-secondary">
                View Event Network
            </a>
            {% endif %}
            <a href="{{ url_for('user.dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
        </div>
    </div>

    {% if matches %}
    <div class="matches-grid">
        {% for match_data in matches %}
        <article class="match-card">
            <div class="match-card-header">
                <h3>{{ match_data.other_user.name }}</h3>
                <span class="match-date">Matched {{ match_data.matched_at.strftime('%B %d, %Y') }}</span>
            </div>
            <div class="match-card-body">
                <div class="match-meta">
                    <div class="match-meta-item">
                        <strong>Email</strong>
                        <span>{{ match_data.other_user.email }}</span>
                    </div>
                    <div class="match-meta-item">
                        <strong>Member since</strong>
                        <span>{{ match_data.other_user.created_at.strftime('%B %Y') }}</span>
                    </div>
                </div>

                {% if match_data.has_meeting %}
                <div class="meeting-panel success">
                    <span class="status-chip success">‚úì Scheduled</span>
                    <div class="info-row">
                        <span>üìÖ</span>
                        <strong>{{ match_data.meeting.start_time.strftime('%A, %B %d at %I:%M %p') }}</strong>
                    </div>
                    <div class="info-row">
                        <span>üìç</span>
                        <span>{{ match_data.meeting.location }}</span>
                    </div>
                    <div class="info-row">
                        <span>üèóÔ∏è</span>
                        <span>{{ match_data.meeting.session_name }}</span>
                    </div>
                </div>
                {% elif match_data.assignment_failed %}
                <div class="meeting-panel alert">
                    <span class="status-chip warning">‚ö†Ô∏è Needs attention</span>
                    <p><strong>Could not auto-assign meeting.</strong></p>
                    <p class="failure-reason">{{ match_data.failure_reason }}</p>
                    <p class="next-steps">
                        Try updating availability, contact the organizer, or connect directly via email.
                    </p>
                </div>
                {% elif match_data.assignment_pending %}
                <div class="meeting-panel pending">
                    <span class="status-chip info">‚è≥ Scheduling</span>
                    <p>We are still assigning a meeting slot for this match. Check back soon!</p>
                </div>
                {% else %}
                <div class="meeting-panel">
                    <p>No meeting scheduled yet. You can still reach out directly.</p>
                </div>
                {% endif %}

                <div class="match-actions">
                    <button class="btn btn-primary" onclick="sendMessage('{{ match_data.other_user.email }}')">
                        Send Message
                    </button>
                    <button class="btn btn-secondary" onclick="viewProfile('{{ match_data.other_user.id }}')">
                        View Profile
                    </button>
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="matches-empty">
        <h3>No matches yet</h3>
        <p>When you find matches they will appear here.</p>
        <a href="{{ url_for('matching.matching_loading', event_id=event.id) }}" class="btn btn-primary">Start Matching</a>
    </div>
    {% endif %}
</div>
{% endblock %}

.no-matches-content .btn:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
}

.no-meeting {
color: #9e9e9e;
font-style: italic;
text-align: center;
margin: 10px 0;
}
</style>

<script>
    function sendMessage(email) {
        // Create mailto link
        const subject = encodeURIComponent(`Connection from {{ event.name }}`);
        const body = encodeURIComponent(`Hi! We matched on {{ event.name }} and I'd love to connect with you professionally.`);
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    }

    function viewProfile(userId) {
        // For now, just show an alert. In a real app, this would open a profile modal or page
        alert('Profile view feature coming soon!');
    }
</script>