{% extends "base.html" %}

{% block title %}Calculating Matches - {{ event.name if event else 'Prophere' }}{% endblock %}

{% block body_class %}matching-body{% endblock %}

{% block content %}
<div class="matching-loading-wrapper">
    <a href="{{ url_for('user.dashboard') }}" class="matching-back-link">‚Üê Back to dashboard</a>

    <div class="matching-loading-card">
        <span class="matching-spinner" role="status" aria-label="Calculating matches"></span>
        <h1 class="matching-title">Calculating Matches</h1>
        <p class="matching-subtitle">
            We are analyzing your interests, availability, and documents to surface the strongest conversations for
            {{ event.name if event else 'this event' }}.
        </p>

        <div class="matching-progress-track" aria-hidden="true">
            <div class="matching-progress-bar"></div>
        </div>

        <div class="matching-steps">
            <div class="matching-step" data-step="1">
                <span class="matching-step-index">1</span>
                <div>
                    <p class="matching-step-title">Analyze interests</p>
                    <p class="matching-step-text">Combining your keywords with current event trends.</p>
                </div>
            </div>
            <div class="matching-step" data-step="2">
                <span class="matching-step-index">2</span>
                <div>
                    <p class="matching-step-title">Process documents</p>
                    <p class="matching-step-text">Reviewing resumes and portfolios for additional signals.</p>
                </div>
            </div>
            <div class="matching-step" data-step="3">
                <span class="matching-step-index">3</span>
                <div>
                    <p class="matching-step-title">Optimize availability</p>
                    <p class="matching-step-text">Aligning your schedule with compatible attendees.</p>
                </div>
            </div>
            <div class="matching-step" data-step="4">
                <span class="matching-step-index">4</span>
                <div>
                    <p class="matching-step-title">Finalize matches</p>
                    <p class="matching-step-text">Locking in conversations and preparing your results.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const steps = document.querySelectorAll('.matching-step');

    const activateStep = (index) => {
        if (index < steps.length) {
            steps[index].classList.add('active');
        }
    };

    steps.forEach((_, idx) => {
        setTimeout(() => activateStep(idx), 600 + (idx * 900));
    });

    setTimeout(() => {
        window.location.href = "{{ url_for('matching.event_matching', event_id=event_id) }}";
    }, 5000);
</script>
{% endblock %}